{# --- product landing fallback: show detailed product when products is a single-item list --- #}
{% if products and products|length == 1 %}
  {% set product = products[0] %}
  <div class="container py-4">
    <div class="row">
      <div class="col-md-6">
        {% if product.images and product.images[0] %}
          <img src="{{ product.images[0] }}" class="img-fluid" alt="{{ product.name }}">
        {% else %}
          <img src="/static/images/logo.png" class="img-fluid" alt="">
        {% endif %}
      </div>
      <div class="col-md-6">
        <h2>{{ product.get('name') or product.get('title') }}</h2>
        <p>{{ product.get('description') or product.get('short_description','') }}</p>
        <h4>{{ product.get('price','') }} {{ product.get('currency','') }}</h4>

        <form id="landing-order-form" method="post" action="/api/landing_order">
          <input type="hidden" name="product_id" value="{{ product.get('id') or product.get('sku') or (product.website|default('')|split('/')[-1]) }}">
          <div class="mb-2"><input name="name" class="form-control" placeholder="الاسم" required></div>
          <div class="mb-2"><input name="phone" class="form-control" placeholder="رقم الهاتف" required></div>
          <div class="mb-2"><input name="city" class="form-control" placeholder="المدينة" required></div>
          <div class="mb-2"><input name="area" class="form-control" placeholder="المنطقة" required></div>
          <div class="mb-2"><textarea name="address" class="form-control" placeholder="العنوان" required></textarea></div>
          <button class="btn btn-primary" type="submit">تأكيد الطلب</button>
        </form>

        <div id="msg" class="mt-2"></div>
      </div>
    </div>
  </div>

  <script>
  document.getElementById('landing-order-form').addEventListener('submit', async function(e){
    e.preventDefault();
    const form = e.target;
    const data = new FormData(form);
    const res = await fetch(form.action, {method:'POST', body: data});
    const json = await res.json();
    if(json.ok){ document.getElementById('msg').innerText = 'تم تسجيل الطلب. رقم: ' + json.order_id; form.reset(); }
    else { document.getElementById('msg').innerText = 'خطأ: ' + (json.error || 'غير معروف'); }
  });
  </script>

  {# انتهى عرض المنتج المفرد، لا تنفّذ حلقة القوائم بعد ذلك #}
{% else %}
  {# هنا تبقى حلقة عرض المنتجات الحالية كما هي (لا تغيّرها) #}
{% endif %}
